<!doctype html>
<html lang="en">
	<head>
    	<meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
    	<title>Register new Account</title>
    </head>
    <style>
		.container{
			justify-content: center;
    		align-items: center;
  			text-align:center;
  		}
	
		.bottomRight{
  			display:block;
  			position:absolute;
  			bottom:0;
  			right:0;
  		}
  		
  		.button {
  			border: none;
  			color: white;
  			padding: 8px 20px;
  			text-align: center;
  			text-decoration: none;
  			display: inline-block;
  			font-size: 16px;
  			margin: 4px 2px;
  			transition-duration: 0.4s;
  			cursor: pointer;
		}

		.button2 {
  			background-color: rgb(210,212,211); 
 		 	color: black; 
 	 		border: 2px solid #008CBA;
		}

		.button2:hover {
  			background-color: #008CBA;
  			color: rgb(237,233,232);
		}
		
		.userProfile {
    		width: 100px;
    		height: 100px;
    		object-fit: cover;
    		object-position: center;
    		border-radius: 20%;
		}
		
		.topleft {
  			position: absolute;
  			top: 0;
  			left: 0;
  			color: rgb(237,233,232); 
		}		
	</style>
	
<body style="background-color:rgb(34,34,34);">
    <div class="topleft">
    	<img src="../img/user.png" alt="Profile Picture:" class="userProfile">
    </div>
    <div class="container">
    	<form id="aux">
        	<h1 style="color:rgb(237,233,232);">Register New Account</h1>
			<br>
			<p style="color:rgb(237,233,232);">Mandatory to Fill</p>
			<label style="color:rgb(237,233,232);" for="username"></label>
					<input type="text" name="username" id="username" placeholder="Username" required>
			<br><br>
				<label style="color:rgb(237,233,232);" for="email"></label>
					<input type="email" name="email" id="email" placeholder="Email" required>
			<br><br>
				<label style="color:rgb(237,233,232);" for="name"></label>
					<input type="text" name="name" id="name" placeholder="Name" required>
			<br><br>
				<label style="color:rgb(237,233,232);" for="password"></label>
					<input type="password" name="password" id="password" placeholder="Password" required>	
			<br><br>
				<label style="color:rgb(237,233,232);" for="confirmation"></label>
					<input type="password" name="confirmation" id="confirmation" placeholder="Confirm Password" required>
			<br>
			<p style="color:rgb(237,233,232);">Optional to Fill<br><br>User picture:<input style="color:rgb(237,233,232);" type="file" id="profilePic" accept="img/*" onchange="updateProfilePic()"></p>
			<label style="color:rgb(237,233,232);" for="profile">Profile:</label>
      		<select name="profile" id="profile" required>
       			<option value="Publico">Publico</option>
       			<option value="Privado">Privado</option>
     		</select>
			<br><br>
			<label style="color:rgb(237,233,232);" for="telephone"></label>
					<input type="text" name="telephone" id="telephone" placeholder="Telephone">
			<br><br>
			<label style="color:rgb(237,233,232);" for="mobilePhone"></label>
					<input type="text" name="mobilePhone" id="mobilePhone" placeholder="MobilePhone">
			<br><br>
			<label style="color:rgb(237,233,232);" for="profession"></label>
					<input type="text" name="profession" id="profession" placeholder="Profession">
			<br><br>
			<label style="color:rgb(237,233,232);" for="workPlace"></label>
					<input type="text" name="workPlace" id="workPlace" placeholder="WorkPlace">
			<br><br>
			<label style="color:rgb(237,233,232);" for="address"></label>
					<input type="text" name="address" id="address" placeholder="Address">
			<br><br>
			<label style="color:rgb(237,233,232);" for="additionalAddress"></label>
					<input type="text" name="additionalAddress" id="additionalAddress" placeholder="Additional Address">
			<br><br>
			<label style="color:rgb(237,233,232);" for="city"></label>
					<input type="text" name="city" id="city" placeholder="City">
			<br><br>
			<label style="color:rgb(237,233,232);" for="zip"></label>
					<input type="text" name="zip" id="zip" placeholder="Zip Code">
			<br><br>
			<label style="color:rgb(237,233,232);" for="nif"></label>
					<input type="text" name="nif" id="nif" placeholder="NIF">
			<br><br>
			<input class="button button2" type="submit" value="Register">
			<br><br><br>
			<a style="color:rgb(237,233,232);" href="/pages/login.html">Already have an account? Sign In</a>
			<br><br>
			<a style="color:rgb(237,233,232);" href="/index.html">Back to Main Page</a>
    	</form>
    </div>
    <div class="bottomRight">
		<p style="color:rgb(237,233,232);">@GoncaloCerveira2023&emsp;&emsp;</p>
	</div>
</body>

<script>
document.addEventListener("DOMContentLoaded", function() {
    var registerForm = document.getElementById("aux");
    registerForm.addEventListener("submit", function(event) {
    	event.preventDefault();
    	var user = document.getElementById("username").value;
		var pass = document.getElementById("password").value;
		var email = document.getElementById("email").value;
		var name = document.getElementById("name").value;
		var confirmation = document.getElementById("confirmation").value;

		var profile = document.getElementById("profile").value;;
		var telePhone = document.getElementById("telephone").value;
		var mobilePhone = document.getElementById("mobilePhone").value;
		var profession = document.getElementById("profession").value;
		var workPlace = document.getElementById("workPlace").value;
		var address = document.getElementById("address").value;
		var additionalAddress = document.getElementById("additionalAddress").value;
		var city = document.getElementById("city").value;
		var zip = document.getElementById("zip").value;
		var nif = document.getElementById("nif").value;
		
		//Replace empty with null 	
		if(telePhone == "")
			telePhone = null;
		if(mobilePhone == "") 
			mobilePhone = null;
		if(profession == "")
			profession = null;
		if(workPlace == "")
			workPlace = null;
		if(address == "")
			address = null;
		if(additionalAddress == "")
			additionalAddress = null;
		if(city == "")
			city = null;
		if(zip == "")
			zip = null;
		if(nif == "")
			nif = null;
		
        var postRegister = {
        	"username": user,
    		"email": email,
    		"name": name,
    		"password": pass,
    		"confirmation": confirmation,
    		"profile": profile,
    		"telephone": telePhone,
    		"mobilePhone": mobilePhone,
    		"profession": profession,
    		"workPlace": workPlace,
    		"address": address,
    		"additionalAddress": additionalAddress,
    		"city": city,
    		"zip": zip,
    		"nif": nif
        };
            
        var xmlhttp = new XMLHttpRequest();
            
        xmlhttp.open("POST", "/rest/register/v1", true);
        xmlhttp.setRequestHeader("Content-Type", "application/json");
        xmlhttp.send(JSON.stringify(postRegister));
            
        xmlhttp.onreadystatechange = function() {
        	if(xmlhttp.readyState === 4 && xmlhttp.status === 200){
        		if(document.getElementById("profilePic").value != "")
        			uploadProfilePic();
                window.location.href = "/pages/registered.html";
        	}
            else if(xmlhttp.readyState === 4)
                alert(xmlhttp.responseText);
        };
    });
});
function updateProfilePic() {
    let selectedFile = document.getElementById("profilePic").files[0];
    document.getElementsByClassName("userProfile")[0].src = URL.createObjectURL(selectedFile);
}
function uploadProfilePic() {
    let fileInput = document.getElementById("profilePic");
    let file = fileInput.files[0];

    let xmlhttp = new XMLHttpRequest();
    xmlhttp.open("POST", "/gcs/individualproject-382911.appspot.com/" + document.getElementById("username").value, false);
    xmlhttp.setRequestHeader("Content-Type", file.type);
    xmlhttp.send(file);
}
</script>
</html>