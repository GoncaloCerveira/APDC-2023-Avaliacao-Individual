<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
	<head>
    	<meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
    	<title>Modify Attributes</title>
	</head>
	<style>
		.container{
			justify-content: center;
    		align-items: center;
  			text-align:center;
  		}
	
		.info{
  			background-color:rgb(34,34,34);
 	 		width: 300px;
  			padding: 5px;
  			margin: 15px;
		}
	
		.bottomRight{
  			display:block;
  			position:absolute;
  			bottom:0;
  			right:0;
  		}
  		
  		.bottomLeft{
  			display:block;
  			position:absolute;
  			bottom:0;
  			left: 0;
  		}
  		
  		.button {
  			border: none;
  			color: white;
  			padding: 8px 20px;
  			text-align: center;
  			text-decoration: none;
  			display: inline-block;
  			font-size: 16px;
  			margin: 4px 2px;
  			transition-duration: 0.4s;
  			cursor: pointer;
		}

		.button1 {
			background-color: rgb(210,212,211); 
		 	color: black; 
		  	border: 2px solid #4CAF50;
		}
		
		.button1:hover {
		  	background-color: #4CAF50;
		  	color: rgb(237,233,232);
		}
  		
  		.button2 {
  			background-color: rgb(210,212,211); 
 	 		color: black; 
 			border: 2px solid #008CBA;
		}

		.button2:hover {
  			background-color: #008CBA;
  			color: rgb(237,233,232);
		}
	</style>
	<body style="background-color:rgb(34,34,34);" onload="loadLoggedUser()">
		<div class="bottomLeft">
			<div id="aux" class="info">
			 	<p style="color:rgb(237,233,232);" id="userShow"></p>
			 	<p style="color:rgb(237,233,232);" id="nameShow"></p>
			 	<p style="color:rgb(237,233,232);" id="profileShow"></p>
			</div>
		</div>
		<div class="container">
			<br><br>
			<h2 style="color:rgb(237,233,232);">Here you can change attributes:</h2>
			<br><br>
			<form>
			<label style="color:rgb(237,233,232);" for="profile">Profile:</label>
				<input type="text" list="profiles" id="profile" required>
      			<datalist style="display:none" id="profiles">
       				<option value="Publico">Publico</option>
       				<option value="Privado">Privado</option>
     			</datalist>
     		</form>
			<br><br>
			<label style="color:rgb(237,233,232);" for="telephone"></label>
					<input type="text" name="telephone" id="telephone" placeholder="Telephone">
			<br><br>
			<label style="color:rgb(237,233,232);" for="mobilePhone"></label>
					<input type="text" name="mobilePhone" id="mobilePhone" placeholder="MobilePhone">
			<br><br>
			<label style="color:rgb(237,233,232);" for="profession"></label>
					<input type="text" name="profession" id="profession" placeholder="Profession">
			<br><br>
			<label style="color:rgb(237,233,232);" for="workPlace"></label>
					<input type="text" name="workPlace" id="workPlace" placeholder="WorkPlace">
			<br><br>
			<label style="color:rgb(237,233,232);" for="address"></label>
					<input type="text" name="address" id="address" placeholder="Address">
			<br><br>
			<label style="color:rgb(237,233,232);" for="additionalAddress"></label>
					<input type="text" name="additionalAddress" id="additionalAddress" placeholder="Additional Address">
			<br><br>
			<label style="color:rgb(237,233,232);" for="city"></label>
					<input type="text" name="city" id="city" placeholder="City">
			<br><br>
			<label style="color:rgb(237,233,232);" for="zip"></label>
					<input type="text" name="zip" id="zip" placeholder="Zip Code">
			<br><br>
			<label style="color:rgb(237,233,232);" for="nif"></label>
					<input type="text" name="nif" id="nif" placeholder="NIF">
			<br><br>
			<label style="color:rgb(237,233,232);" for="username"></label>
					<input style="display:none" type="text" name="username" id="username" placeholder="Username">
			<br><br>
				<label style="color:rgb(237,233,232);" for="email"></label>
					<input style="display:none" type="email" name="email" id="email" placeholder="Email">
			<br><br>
				<label style="color:rgb(237,233,232);" for="name"></label>
					<input style="display:none" type="text" name="name" id="name" placeholder="Name">
			<br><br>
			<label style="color:rgb(237,233,232);" for="role">Role:</label>
				<input type="text" list="roles" id="role">
      			<datalist style="display:none" id="roles">
       				<option value="USER">USER</option>
       				<option id="roleGBO" value="GBO">GBO</option>
       				<option id="roleGA" value="GA">GA</option>
       				<option id="roleGS" value="GS">GS</option>
       				<option id="roleSU" value="SU">SU</option>
     			</datalist>
     		<br><br>
     		<label style="color:rgb(237,233,232);" for="state">State:</label>
     			<input type="text" list="states" id="state">
      			<datalist style="display:none" id="states">
       				<option value="ATIVO">ACTIVE</option>
       				<option value="INATIVO">INACTIVE</option>
     			</datalist>
     		<br><br>
			<button class="button button1" onclick="modifyAttributes()">Change Attributes</button>
			<button class="button button2" onclick="window.location.href = '/pages/showUserInfo.html'">See your Attributes</button>
			<br>
			<button class="button button1" onclick="window.location.href = '/pages/userLogged.html'">Go Back</button>
			<p style="display:none" id="roleShow"></p>
		</div>
		<div class="bottomRight">
			<p style="color:rgb(237,233,232);">@GoncaloCerveira2023&emsp;&emsp;</p>
		</div>
	
		<script>
		function modifyAttributes(){
			var xmlhttp = new XMLHttpRequest();

			var user = document.getElementById("userShow").innerHTML;
			var username = document.getElementById("username").value;
			var email = document.getElementById("email").value;
			var name = document.getElementById("name").value;

			var profile = document.getElementById("profile").value;
			var telePhone = document.getElementById("telephone").value;
			var mobilePhone = document.getElementById("mobilePhone").value;
			var profession = document.getElementById("profession").value;
			var workPlace = document.getElementById("workPlace").value;
			var address = document.getElementById("address").value;
			var additionalAddress = document.getElementById("additionalAddress").value;
			var city = document.getElementById("city").value;
			var zip = document.getElementById("zip").value;
			var nif = document.getElementById("nif").value;
			var role = document.getElementById("role").value;
			var state = document.getElementById("state").value;
			
			var color = document.getElementById("roleShow").innerHTML;
			
			if(color == "USER"){
				username = document.getElementById("userShow").innerHTML;
				role = null;
				email = null;
				name = null;
				state = null;
			}
			
			if(color == "GBO"){
			
			}
			
			//Replace empty with null
			if(profile == "")
				profile == null;
			if(role == "")
				role = null;
			if(state == "")
				state = null;
			if(name == "")
				name = null;
			if(email == "")
				email = null;
			if(telePhone == "")
				telePhone = null;
			if(mobilePhone == "") 
				mobilePhone = null;
			if(profession == "")
				profession = null;
			if(workPlace == "")
				workPlace = null;
			if(address == "")
				address = null;
			if(additionalAddress == "")
				additionalAddress = null;
			if(city == "")
				city = null;
			if(zip == "")
				zip = null;
			if(nif == "")
				nif = null;
			
	        var postModifyAttribute = {
	        	"user": user,
	        	"username": username,
	    		"email": email,
	    		"name": name,
	    		"profile": profile,
	    		"telephone": telePhone,
	    		"mobilePhone": mobilePhone,
	    		"profession": profession,
	    		"workPlace": workPlace,
	    		"address": address,
	    		"additionalAddress": additionalAddress,
	    		"city": city,
	    		"zip": zip,
	    		"nif": nif,
	    		"role": role,
	    		"state": state
	        }
			
	        var json = JSON.stringify(postModifyAttribute);
	   		
	    	xmlhttp.onreadystatechange = function() {
	   			if(xmlhttp.readyState == 4) {
	   				if(xmlhttp.status == 200){
	   					alert(xmlhttp.responseText);
	   				} 
	   				else{
	   					alert(xmlhttp.responseText);
	   				}
	   			}
	   		}
	    	
	    	xmlhttp.open("POST", document.location.origin + "/rest/modifyAttributes/v1", true);
	    	xmlhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
	    	xmlhttp.send(json);
		}

		function loadLoggedUser() {
			var xmlhttp = new XMLHttpRequest();
	        
	        var user = localStorage.getItem("userLogged");
	        
			var postLogged = {
				"username": user
			}
			
			var json = JSON.stringify(postLogged);
			
			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == 4) {
					if (xmlhttp.status == 200) {
						var userLogged = JSON.parse(this.responseText);

						document.getElementById("userShow").innerHTML = userLogged.username;
						document.getElementById("nameShow").innerHTML = userLogged.name;
						document.getElementById("profileShow").innerHTML = userLogged.profile;
						document.getElementById("roleShow").innerHTML = userLogged.role;
						
						var color = userLogged.role;
						
						if(color == "SU") {
							document.getElementById("aux").style.border = "2px solid red";
							document.getElementById("username").style.display = "initial";
							document.getElementById("email").style.display = "initial";
							document.getElementById("name").style.display = "initial";
							document.getElementById("profile").style.display = "initial";
							document.getElementById("role").style.display = "initial";
							document.getElementById("state").style.display = "initial";
							document.getElementById("roleGBO").style.display = "initial";
							document.getElementById("roleGS").style.display = "initial";
							document.getElementById("roleGA").style.display = "initial";
							document.getElementById("roleSU").style.display = "initial";
						} 
						else if(color == "GS") {
							document.getElementById("aux").style.border = "2px solid orange";
							document.getElementById("username").style.display = "initial";
							document.getElementById("email").style.display = "initial";
							document.getElementById("name").style.display = "initial";
							document.getElementById("profile").style.display = "initial";
							document.getElementById("role").style.display = "initial";
							document.getElementById("state").style.display = "initial";
							document.getElementById("roleGBO").style.display = "initial";
							document.getElementById("roleGS").style.display = "none";
							document.getElementById("roleGA").style.display = "initial";
							document.getElementById("roleSU").style.display = "none";
						}
						else if(color == "GA") {
							document.getElementById("aux").style.border = "2px solid pink";
							document.getElementById("username").style.display = "initial";
							document.getElementById("email").style.display = "initial";
							document.getElementById("name").style.display = "initial";
							document.getElementById("profile").style.display = "initial";
							document.getElementById("role").style.display = "initial";
							document.getElementById("state").style.display = "initial";
							document.getElementById("roleGBO").style.display = "initial";
							document.getElementById("roleGS").style.display = "none";
							document.getElementById("roleGA").style.display = "none";
							document.getElementById("roleSU").style.display = "none";
						}  
						else if(color == "GBO") {
							document.getElementById("aux").style.border = "2px solid yellow";
							document.getElementById("username").style.display = "initial";
							document.getElementById("email").style.display = "initial";
							document.getElementById("name").style.display = "initial";
							document.getElementById("profile").style.display = "initial";
							document.getElementById("role").style.display = "initial";
							document.getElementById("state").style.display = "initial";
							document.getElementById("roleGBO").style.display = "none";
							document.getElementById("roleGS").style.display = "none";
							document.getElementById("roleGA").style.display = "none";
							document.getElementById("roleSU").style.display = "none";
						}
						else {
							document.getElementById("aux").style.border = "2px solid green";
							document.getElementById("username").style.display = "none";
							document.getElementById("email").style.display = "none";
							document.getElementById("name").style.display = "none";
							document.getElementById("profile").style.display = "none";
							document.getElementById("role").style.display = "none";
							document.getElementById("state").style.display = "none";
							document.getElementById("roleGBO").style.display = "none";
							document.getElementById("roleGS").style.display = "none";
							document.getElementById("roleGA").style.display = "none";
							document.getElementById("roleSU").style.display = "none";
						}
					}
				}
			}

			xmlhttp.open("POST", document.location.origin + "/rest/infoUser/v1", true);
			xmlhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
			xmlhttp.send(json);
		}
		
		function goToLogin(){
		    if(localStorage.getItem("userLogged") === ""){
		        window.location.href = "/login.html";
		    }
		}

		window.addEventListener('load', goToLogin);
		</script>
	</body>
</html>